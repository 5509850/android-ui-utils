<!DOCTYPE html>
<html>
  <head>
    <title>Android Asset Studio - Icon Generator - Menu icons</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="http://yui.yahooapis.com/2.8.1/build/reset/reset-min.css">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/themes/base/jquery.ui.all.css">
    <!-- canvg used to overcome <img src=SVG> toDataURL security issues -->
    <!-- see code.google.com/p/chromium/issues/detail?id=54204 -->
    <script src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script> 
    <script src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script>

    <link rel="stylesheet" href="lib/colorpicker/css/colorpicker.css">
    <script src="lib/colorpicker/js/colorpicker.js"></script>

    <link rel="stylesheet" href="lib/jquery-ui-1.8.4.android-theme/theme.css">

    <link rel="stylesheet" href="css/studio.css">
    <script src="js/asset-studio.pack.js"></script>
  </head>
  <body>
    <div id="main-container">
      <div id="header">
        <h1><a href="index.html">Android Asset Studio</a></h1>
      </div>
      <div id="page-header">
        <div id="breadcrumb">
          <a href="index.html">Android Asset Studio</a> &raquo;
          <a href="index.html#group-icon-generators">Icon generators</a> &raquo;
          <em>Menu icons</em>
        </div>
        <p id="page-intro">
          The <strong>menu icon generator</strong> will create icons that you
          can use in your Android application, from a variety of source images.
          To begin, simply enter the input details below. Output will be shown
          below.
        </p>
      </div>
      <div id="inputs">
        <div id="inputs-form"></div>
        <input type="checkbox" id="output-try-system" checked="checked">
        <label for="output-try-system">Use framework asset where possible</label><br>
      </div>
      <div id="outputs">
        <h3>Output images</h3>
      </div>
      <div id="footer">
        <p>See the source at the <a href="http://code.google.com/p/android-ui-utils">android-ui-utils</a> Google Code project.</p>
      </div>
    </div>

    <script>
      $('#output-try-system')
          .button()
          .change(regenerate);

      // Create image output slots
      for (var density in {'hdpi':1, 'mdpi':1, 'ldpi':1})
        studio.ui.createImageOutputSlot({
          container: $('#outputs').get(0),
          id: 'out-icon-' + density,
          label: 'drawable-' + density
        });

      var paramResources = {
        'hdpi-iconSize': { w: 72, h: 72 },
        'mdpi-iconSize': { w: 48, h: 48 },
        'ldpi-iconSize': { w: 36, h: 36 },
        'hdpi-targetRect': { x: 0, y: 0, w: 72, h: 72 },
        'mdpi-targetRect': { x: 0, y: 0, w: 48, h: 48 },
        'ldpi-targetRect': { x: 0, y: 0, w: 36, h: 36 },
//        'hdpi-targetRect': { x: 8, y: 8, w: 56, h: 56 },
//        'mdpi-targetRect': { x: 5, y: 5, w: 38, h: 38 },
//        'ldpi-targetRect': { x: 4, y: 4, w: 28, h: 28 },
        'hdpi-fxMult': 1.0,
        'mdpi-fxMult': 0.666667,
        'ldpi-fxMult': 0.5
      };

      var sysReplacements = {
        'add.svg': 'add',
        'back.svg': 'back',
        'block.svg': 'block',
        'camera.svg': 'camera',
        'edit.svg': 'edit',
        'export.svg': 'export',
        'home.svg': 'home',
        'mylocation.svg': 'mylocation',
        'play_clip.svg': 'play_clip',
        'refresh.svg': 'refresh',
        'search.svg': 'search',
        'share.svg': 'share',
        'sort_by_size.svg': 'sort_by_size',
        'star.svg': 'star',
        'stop.svg': 'stop'
      };

      /**
       * Main image generation routine.
       */
      function regenerate() {
        var values = form.getValues();
        var sourceName = values['source'].name;

        if ($('#output-try-system').is(':checked') &&
            sourceName &&
            sysReplacements.hasOwnProperty(sourceName)) {
          var replacement = sysReplacements[sourceName];
          $('#out-icon-hdpi').attr('src',
              'http://android.git.kernel.org/?p=platform/frameworks/base.git;' +
              'a=blob_plain;f=core/res/res/drawable-hdpi/ic_menu_' + replacement
              + '.png;hb=master');
          $('#out-icon-mdpi').attr('src',
              'http://android.git.kernel.org/?p=platform/frameworks/base.git;' +
              'a=blob_plain;f=core/res/res/drawable-mdpi/ic_menu_' + replacement
              + '.png;hb=master');
          $('#out-icon-ldpi').attr('src', '');
          return;
        }

        if (!values['source'].uri) {
          return;
        }

        imagelib.loadFromUri(values['source'].uri, function(srcImg) {
          if (!srcImg) {
            return;
          }

          var srcSize = { w: srcImg.naturalWidth, h: srcImg.naturalHeight };
          var srcRect = { x: 0, y: 0, w: srcSize.w, h: srcSize.h };

          for (var density in {'hdpi':1, 'mdpi':1, 'ldpi':1}) {
            var iconSize = paramResources[density + '-iconSize'];
            var fxMult = paramResources[density + '-fxMult'];
            var targetRect = paramResources[density + '-targetRect'];

            var outCtx = imagelib.drawing.context(iconSize);
            var srcCtx = imagelib.drawing.context(iconSize);

            imagelib.drawing.drawCenterInside(srcCtx, srcImg, targetRect, srcRect);

            imagelib.drawing.fx([
              {
                effect: 'outer-shadow',
                color: '#fff',
                opacity: 0.55,
                blur: 3 * fxMult
              },
              {
                effect: 'inner-shadow',
                color: '#000',
                opacity: 0.2,
                blur: 3 * fxMult,
                translate: { y: 3 * fxMult }
              },
              {
                effect: 'inner-shadow',
                color: '#000',
                opacity: 0.35,
                translate: { y: 1 }
              },
              {
                effect: 'inner-shadow',
                color: '#fff',
                opacity: 0.7,
                translate: { y: -1 }
              },
              {
                effect: 'fill-lineargradient',
                from: { x: 0, y: 0 },
                to: { x: 0, y: iconSize.h },
                colors: [
                  { offset: 0, color: '#a3a3a3' },
                  { offset: 1.0, color: '#787878' }
                ]
              }
            ], outCtx, srcCtx, iconSize);

            imagelib.loadFromUri(outCtx.canvas.toDataURL(), function(density) {
              return function(img) {
                $('#out-icon-' + density).attr('src', img.src);
              };
            }(density));
          }
        });
      }

      var form = new studio.forms.Form('icon-form', {
        onChange: regenerate,
        fields: [
          new studio.forms.ImageField('source', {
            title: 'Source',
            defaultValueTrim: 1
          })
        ]
      });
      form.createUI($('#inputs-form').get(0));
    </script>
  </body>
</html>