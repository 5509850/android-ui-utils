<!DOCTYPE html>
<html>
  <head>
    <title>Android Asset Studio - Icon Generator - Notification icons</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="http://yui.yahooapis.com/2.8.1/build/reset/reset-min.css">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/themes/base/jquery.ui.all.css">
    <!-- canvg used to overcome <img src=SVG> toDataURL security issues -->
    <!-- see code.google.com/p/chromium/issues/detail?id=54204 -->
    <script src="http://canvg.googlecode.com/svn/trunk/rgbcolor.js"></script> 
    <script src="http://canvg.googlecode.com/svn/trunk/canvg.js"></script>

    <link rel="stylesheet" href="lib/colorpicker/css/colorpicker.css">
    <script src="lib/colorpicker/js/colorpicker.js"></script>

    <link rel="stylesheet" href="lib/jquery-ui-1.8.4.android-theme/theme.css">

    <link rel="stylesheet" href="css/studio.css">
    <script src="js/asset-studio.pack.js"></script>
  </head>
  <body>
    <div id="main-container">
      <div id="header">
        <h1><a href="index.html">Android Asset Studio</a></h1>
      </div>
      <div id="page-header">
        <div id="breadcrumb">
          <a href="index.html">Android Asset Studio</a> &raquo;
          <a href="index.html#group-icon-generators">Icon generators</a> &raquo;
          <em>Notification icons</em>
        </div>
        <p id="page-intro">
          The <strong>notification icon generator</strong> will create icons that you
          can use in your Android application, from a variety of source images.
          To begin, simply enter the input details below. Output will be shown
          below.
        </p>
      </div>
      <div id="inputs"></div>
      <div id="outputs">
        <h3>Output images</h3>
      </div>
      <div id="footer">
        <p>See the source at the <a href="http://code.google.com/p/android-ui-utils">android-ui-utils</a> Google Code project.</p>
      </div>
    </div>

    <script>
      // Create image output slots
      for (var density in {'hdpi':1, 'mdpi':1, 'ldpi':1})
        studio.ui.createImageOutputSlot({
          container: $('#outputs').get(0),
          id: 'out-icon-' + density,
          label: 'drawable-' + density
        });

      // Load image resources (stencils)
      var resList = {};
      for (var density in {'hdpi':1, 'mdpi':1, 'ldpi':1})
        for (var shape in {'square':1, 'circle':1})
          resList[shape + '-' + density] = (
            'res/notification-stencil/' + shape + '/' + density + '.png');

      var imageResources = {};
      imagelib.loadImageResources(resList, function(r) {
        imageResources = r;
        regenerate();
      });

      var paramResources = {
        'hdpi-iconSize': { w: 38, h: 38 },
        'mdpi-iconSize': { w: 25, h: 25 },
        'ldpi-iconSize': { w: 19, h: 19 },
        'square-hdpi-targetRect': { x: 6, y: 6, w: 26, h: 26 },
        'circle-hdpi-targetRect': { x: 7, y: 7, w: 24, h: 24 },
        'square-mdpi-targetRect': { x: 4, y: 4, w: 17, h: 17 },
        'circle-mdpi-targetRect': { x: 5, y: 5, w: 15, h: 15 },
        'square-ldpi-targetRect': { x: 4, y: 4, w: 11, h: 11 },
        'circle-ldpi-targetRect': { x: 4, y: 4, w: 11, h: 11 }
      };

      /**
       * Main image generation routine.
       */
      function regenerate() {
        var values = form.getValues();

        // TODO: just add support for required inputs
        if (!values['source'].uri) {
          return;
        }

        imagelib.loadFromUri(values['source'].uri, function(srcImg) {
          if (!srcImg) {
            return;
          }

          var srcSize = { w: srcImg.naturalWidth, h: srcImg.naturalHeight };
          var srcRect = { x: 0, y: 0, w: srcSize.w, h: srcSize.h };

          var shape = values['shape'];
          for (var density in {'hdpi':1, 'mdpi':1, 'ldpi':1}) {
            var iconSize = paramResources[density + '-iconSize'];
            var targetRect = paramResources[shape + '-' + density + '-targetRect'];

            var outCtx = imagelib.drawing.context(iconSize);
            var tmpCtx = imagelib.drawing.context(iconSize);

            tmpCtx.save();
            imagelib.drawing.drawCenterInside(tmpCtx, srcImg, targetRect, srcRect);
            tmpCtx.globalCompositeOperation = 'source-atop';
            tmpCtx.fillStyle = '#fff';
            tmpCtx.fillRect(0, 0, iconSize.w, iconSize.h);
            tmpCtx.restore();

            imagelib.drawing.copy(outCtx, imageResources[shape + '-' + density], iconSize);
            imagelib.drawing.copy(outCtx, tmpCtx, iconSize);

            imagelib.loadFromUri(outCtx.canvas.toDataURL(), function(density) {
              return function(img) {
                $('#out-icon-' + density).attr('src', img.src);
              };
            }(density));
          }
        });
      }

      var form = new studio.forms.Form('icon-form', {
        onChange: regenerate,
        fields: [
          new studio.forms.ImageField('source', {
            title: 'Source',
            defaultValueTrim: 1
          }),
          new studio.forms.EnumField('shape', {
            title: 'Shape',
            buttons: true,
            options: [
              { id: 'square', title: 'Square' },
              { id: 'circle', title: 'Circle' }
            ],
            defaultValue: 'square'
          })
        ]
      });
      form.createUI($('#inputs').get(0));
    </script>
  </body>
</html>